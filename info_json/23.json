{
  "id": 23,
  "repo": "iroh",
  "issue_url": "https://github.com/n0-computer/iroh/issues/2505",
  "pr_url": "https://github.com/n0-computer/iroh/pull/2492",
  "issue_description": "https://github.com/n0-computer/iroh/actions/runs/9890897640/job/27320162992?pr=2492\r\n\r\n```\r\n        FAIL [   5.127s] iroh-net discovery::local_swarm_discovery::tests::test_local_swarm_discovery\r\n\r\n--- STDOUT:              iroh-net discovery::local_swarm_discovery::tests::test_local_swarm_discovery ---\r\n\r\nrunning 1 test\r\ntest discovery::local_swarm_discovery::tests::test_local_swarm_discovery ... FAILED\r\n\r\nfailures:\r\n\r\nfailures:\r\n    discovery::local_swarm_discovery::tests::test_local_swarm_discovery\r\n\r\ntest result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 109 filtered out; finished in 5.11s\r\n\r\n\r\n--- STDERR:              iroh-net discovery::local_swarm_discovery::tests::test_local_swarm_discovery ---\r\nthread 'discovery::local_swarm_discovery::tests::test_local_swarm_discovery' panicked at iroh-net/src/discovery/local_swarm_discovery.rs:316:22:\r\nerror: tokio::time::error::Elapsed - deadline has elapsed\r\nstack backtrace:\r\n   0: rust_begin_unwind\r\n             at /rustc/129f3b9964af4d4a709d1383930ade12dfe7c081/library/std/src/panicking.rs:652:5\r\n   1: core::panicking::panic_fmt\r\n             at /rustc/129f3b9964af4d4a709d1383930ade12dfe7c081/library/core/src/panicking.rs:72:14\r\n   2: <testresult::TestError as core::convert::From<T>>::from\r\n             at /root/.cargo/registry/src/index.crates.io-6f17d22bba15001f/testresult-0.4.0/src/lib.rs:20:9\r\n   3: <core::result::Result<T,F> as core::ops::try_trait::FromResidual<core::result::Result<core::convert::Infallible,E>>>::from_residual\r\n             at /rustc/129f3b9964af4d4a709d1383930ade12dfe7c081/library/core/src/result.rs:1964:27\r\n   4: iroh_net::discovery::local_swarm_discovery::tests::test_local_swarm_discovery::{{closure}}\r\n             at ./src/discovery/local_swarm_discovery.rs:316:22\r\n   5: <core::pin::Pin<P> as core::future::future::Future>::poll\r\n             at /rustc/129f3b9964af4d4a709d1383930ade12dfe7c081/library/core/src/future/future.rs:123:9\r\n   6: <core::pin::Pin<P> as core::future::future::Future>::poll\r\n             at /rustc/129f3b9964af4d4a709d1383930ade12dfe7c081/library/core/src/future/future.rs:123:9\r\n   7: tokio::runtime::scheduler::current_thread::CoreGuard::block_on::{{closure}}::{{closure}}::{{closure}}\r\n             at /root/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.38.0/src/runtime/scheduler/current_thread/mod.rs:659:57\r\n   8: tokio::runtime::coop::with_budget\r\n             at /root/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.38.0/src/runtime/coop.rs:107:5\r\n   9: tokio::runtime::coop::budget\r\n             at /root/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.38.0/src/runtime/coop.rs:73:5\r\n  10: tokio::runtime::scheduler::current_thread::CoreGuard::block_on::{{closure}}::{{closure}}\r\n             at /root/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.38.0/src/runtime/scheduler/current_thread/mod.rs:659:25\r\n  11: tokio::runtime::scheduler::current_thread::Context::enter\r\n             at /root/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.38.0/src/runtime/scheduler/current_thread/mod.rs:404:19\r\n  12: tokio::runtime::scheduler::current_thread::CoreGuard::block_on::{{closure}}\r\n             at /root/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.38.0/src/runtime/scheduler/current_thread/mod.rs:658:36\r\n  13: tokio::runtime::scheduler::current_thread::CoreGuard::enter::{{closure}}\r\n             at /root/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.38.0/src/runtime/scheduler/current_thread/mod.rs:737:68\r\n  14: tokio::runtime::context::scoped::Scoped<T>::set\r\n             at /root/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.38.0/src/runtime/context/scoped.rs:40:9\r\n  15: tokio::runtime::context::set_scheduler::{{closure}}\r\n             at /root/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.38.0/src/runtime/context.rs:180:26\r\n  16: std::thread::local::LocalKey<T>::try_with\r\n             at /rustc/129f3b9964af4d4a709d1383930ade12dfe7c081/library/std/src/thread/local.rs:286:12\r\n  17: std::thread::local::LocalKey<T>::with\r\n             at /rustc/129f3b9964af4d4a709d1383930ade12dfe7c081/library/std/src/thread/local.rs:262:9\r\n  18: tokio::runtime::context::set_scheduler\r\n             at /root/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.38.0/src/runtime/context.rs:180:9\r\n  19: tokio::runtime::scheduler::current_thread::CoreGuard::enter\r\n             at /root/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.38.0/src/runtime/scheduler/current_thread/mod.rs:737:27\r\n  20: tokio::runtime::scheduler::current_thread::CoreGuard::block_on\r\n             at /root/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.38.0/src/runtime/scheduler/current_thread/mod.rs:646:19\r\n  21: tokio::runtime::scheduler::current_thread::CurrentThread::block_on::{{closure}}\r\n             at /root/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.38.0/src/runtime/scheduler/current_thread/mod.rs:175:28\r\n  22: tokio::runtime::context::runtime::enter_runtime\r\n             at /root/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.38.0/src/runtime/context/runtime.rs:65:16\r\n  23: tokio::runtime::scheduler::current_thread::CurrentThread::block_on\r\n             at /root/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.38.0/src/runtime/scheduler/current_thread/mod.rs:167:9\r\n  24: tokio::runtime::runtime::Runtime::block_on\r\n             at /root/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.38.0/src/runtime/runtime.rs:347:47\r\n  25: iroh_net::discovery::local_swarm_discovery::tests::test_local_swarm_discovery\r\n             at ./src/discovery/local_swarm_discovery.rs:324:9\r\n  26: iroh_net::discovery::local_swarm_discovery::tests::test_local_swarm_discovery::{{closure}}\r\n             at ./src/discovery/local_swarm_discovery.rs:299:46\r\n  27: core::ops::function::FnOnce::call_once\r\n             at /rustc/129f3b9964af4d4a709d1383930ade12dfe7c081/library/core/src/ops/function.rs:250:5\r\n  28: core::ops::function::FnOnce::call_once\r\n             at /rustc/129f3b9964af4d4a709d1383930ade12dfe7c081/library/core/src/ops/function.rs:250:5\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\n```",
  "files_changed": [
    {
      "filename": "iroh-net/src/discovery/local_swarm_discovery.rs",
      "status": "modified",
      "patch": "@@ -296,6 +296,7 @@ mod tests {\n     use testresult::TestResult;\n \n     #[tokio::test]\n+    #[ignore = \"flaky\"]\n     async fn test_local_swarm_discovery() -> TestResult {\n         let (node_id_a, discovery_a) = make_discoverer()?;\n         let (_, discovery_b) = make_discoverer()?;"
    },
    {
      "filename": "iroh-net/src/endpoint.rs",
      "status": "modified",
      "patch": "@@ -554,6 +554,9 @@ impl Endpoint {\n     /// Only connections with the ALPNs configured in [`Builder::alpns`] will be accepted.\n     /// If multiple ALPNs have been configured the ALPN can be inspected before accepting\n     /// the connection using [`Connecting::alpn`].\n+    ///\n+    /// The returned future will yield `None` if the endpoint is closed by calling\n+    /// [`Endpoint::close`].\n     pub fn accept(&self) -> Accept<'_> {\n         Accept {\n             inner: self.endpoint.accept(),"
    }
  ],
  "fix_category": NaN,
  "root_cause_category": NaN,
  "root_cause_subcategory": "Ignored"
}